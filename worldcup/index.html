<!doctype html>
<html>
    <head>
        <meta charset="utf-8">

        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-120894276-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-120894276-1');
        </script>

        <title>World Cup 2018 Sweepstake</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link rel="shortcut icon" href="favicon.ico" />
        <style>
            * {
                font-family: sans-serif;
                color: #ccc;
            }

            body {
                background-color: #111;
            }

            .container {
                max-width: 800px;
                margin: 0 auto;
            }

            table {
                table-layout: fixed;
                width: 100%;
                border-collapse: collapse;
            }

            th, td {
                border: 1px solid #333;
                padding: 8px;
                text-align: left;
            }

            tbody td:nth-child(1) {
                width: 40%;
            }

            tbody td:nth-child(2) {
                width: 60%;
            }

            .unallocated-teams {
                margin-top: 16px;
            }

            .team {
                display: inline-block;
                background-color: #333;
                border-radius: 4px;
                padding: 4px;
                margin: 4px;
                white-space: nowrap
            }

            .team.knocked-out {
                text-decoration: line-through;
                background-color: #222;
                color: #999;
            }

            .team .flag {
                height: 16px;
                border-radius: 4px;
            }
            .team.knocked-out .flag {
                filter: brightness(25%)
            }
        </style>
        <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.min.js"></script>
    </head>
    <body>
        <div id="app" class="container">
            <h1>World Cup 2018 Sweepstake</h1>
            <table>
                <tbody>
                    <tr v-for="person in people_with_teams">
                        <td class="player">{{ person.name }}</td>
                        <td>
                            <div v-for="team in person.teams"
                                class="team" :class="{'knocked-out': team.knocked_out}">
                                {{ team.name }} <img :src="team.flag_url" class="flag"/>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="unallocated-teams">
                <div v-for="(team, index) in unallocated_teams"
                     class="team">
                    {{ team.name }} <img :src="team.flag_url" class="flag"/>
                </div>
            </div>
            <p><strong>Good luck!</strong> ðŸ¤‘</p>
        </div>

        <script>
            function Person(name, teams) {
                this.name = name;
                this.teams = teams;
            }

            function Team(code, name, group, knocked_out) {
                this.code = code;
                this.name = name;
                this.group = group;
                this.knocked_out = knocked_out;
                this.flag_url = "flags/" + this.code.toLowerCase() + ".gif";
            }

            var app = new Vue({
                el: '#app',
                data: function() {
                    var teams = [
                        new Team('ARG',     'Argentina',    'D',    false),
                        new Team('AUS',     'Australia',    'C',    false),
                        new Team('BEL',     'Belgium',      'G',    false),
                        new Team('BRA',     'Brazil',       'E',    false),
                        new Team('COL',     'Colombia',     'H',    false),
                        new Team('CRC',     'Costa Rica',   'E',    false),
                        new Team('CRO',     'Croatia',      'D',    false),
                        new Team('DEN',     'Denmark',      'C',    false),
                        new Team('EGY',     'Egypt',        'A',    false),
                        new Team('ENG',     'England',      'G',    false),
                        new Team('FRA',     'France',       'C',    false),
                        new Team('GER',     'Germany',      'F',    false),
                        new Team('ISL',     'Iceland',      'D',    false),
                        new Team('IRN',     'Iran',         'B',    false),
                        new Team('JPN',     'Japan',        'H',    false),
                        new Team('MEX',     'Mexico',       'F',    false),
                        new Team('MAR',     'Morocco',      'B',    false),
                        new Team('NGA',     'Nigeria',      'D',    false),
                        new Team('PAN',     'Panama',       'G',    false),
                        new Team('PER',     'Peru',         'C',    false),
                        new Team('POL',     'Poland',       'H',    false),
                        new Team('POR',     'Portugal',     'B',    false),
                        new Team('RUS',     'Russia',       'A',    false),
                        new Team('KSA',     'Saudi Arabia', 'A',    false),
                        new Team('SEN',     'Senegal',      'H',    false),
                        new Team('SRB',     'Serbia',       'E',    false),
                        new Team('KOR',     'South Korea',  'F',    false),
                        new Team('ESP',     'Spain',        'B',    false),
                        new Team('SWE',     'Sweden',       'F',    false),
                        new Team('SUI',     'Switzerland',  'E',    false),
                        new Team('TUN',     'Tunisia',      'G',    false),
                        new Team('URU',     'Uruguay',      'A',    false)
                    ];
                    var people = [
                        new Person('Andrew C.',     ['MEX', 'SUI']),
                        new Person('Andrew E.',     ['BRA', 'FRA']),
                        new Person('Anna S.',       ['COL', 'ISL']),
                        new Person('David H.',      ['GER', 'SWE']),
                        new Person('Freyja W.',     ['CRO', 'DEN']),
                        new Person('John M.',       ['CRC', 'NGA']),
                        new Person('Patrick G.',    ['AUS', 'ESP']),
                        new Person('Ryan S.',       ['JPN', 'KOR']),
                        new Person('Sam D.',        ['EGY', 'POR']),
                        new Person('Sam W.',        ['RUS', 'URU']),
                        new Person('Scott B.',      ['MAR', 'KSA'])
                    ];

                    return {
                        teams: teams,
                        people: people
                    }
                },
                computed: {
                    people_with_teams: function() {
                        var teams_by_code = {};
                        this.teams.forEach(function(team) {
                            teams_by_code[team.code] = team;
                        });

                        return result = this.people.map(function(person) {
                            return {
                                'name': person.name,
                                'teams': person.teams.map(function(team_code) {
                                    return teams_by_code[team_code];
                                })
                            }
                        });
                        return result;
                    },
                    unallocated_teams: function() {
                        var allocated_team_codes = this.people.map(function(person) {
                            return person.teams;
                        }).reduce(function(a, b) { return a.concat(b); }, []);
                        return result =  this.teams.filter(function(team) {
                            return allocated_team_codes.indexOf(team.code) == -1;
                        });
                    }
                }
            })
        </script>
    </body>
</html>
